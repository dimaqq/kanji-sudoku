<!DOCTYPE html>
<html><head>
<script src="https://unpkg.com/react@15.3.2/dist/react.js"></script>
<script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.js"></script>
<script src="https://npmcdn.com/react-router@2.5.2/umd/ReactRouter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.23.0/polyfill.js"></script>
<script src="./kanji.js" charset="UTF-8"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css" />
<style type="text/css">
a { text-decoration: none; padding-left: 1em; padding-right: 1em; border-radius: 2px; }
.active { background-color: #1EAEDB; color: white }
.registration { max-width: 400px; }
input:disabled { background:#ccc ! important; border-color: #ccc ! important; text-shadow:none; }
.debug { line-height: 1.2em; color: #1EAEDB ! important; display: none; }
.wide { margin-left: 0.2em; margin-right: 0.2em; }
// .row { width: 100%; }
//.button { padding: 1em ! important; }
.one-and-half { width: 8.95%; }
.small { height: 2em ! important; vertical-align: middle; }
.select-container { margin: 1em auto; display: table; width: 75vmin; display: flex; }
.select-title { display: inline-block; margin-right: auto; }
.select-button { display: inline-block;
                 border: 1px solid black;
                 margin-left: -1px; margin-right: 0px;
                 border-radius: 0;
                 padding: 0em 1em; }
.select-button:hover { background-color: #eee; }
.selected { background-color: #fcc; }

.select-button:nth-child(2) { border-radius: 0.3em 0 0 0.3em; }
.select-button:last-child { border-radius: 0 0.3em 0.3em 0; }

.kcont, table.sudoku {
    display: table;
    border-collapse: collapse;
    -webkit-border-horizontal-spacing: 0;
    -webkit-border-vertical-spacing: 0; 
    margin-left: auto; margin-right: auto; margin-bottom: 1em; }
td { height: 1.6em; width: 1.6em; border: 1px solid; text-align: center; }
td, th:first-child, td:first-child, th:last-child, td:last-child { padding: 0.1em 0.1em 0.1em 0.1em; margin: 0 0 0 0; }
td:first-child { border-left:3px solid; }
td:nth-child(3n) { border-right:2px solid; }
td:last-child { border-right:3px solid; }
tr:first-child { border-top:3px solid; }
tr:nth-child(3n) td { border-bottom:solid ; }
tr:last-child { border-bottom: 3px solid; }

</style>
<style type="text/css" media="print">
.noprint { display: none; }
.kcont, table.sudoku { font-size: 240%; }
</style>
<style type="text/css" media="screen">
.kcont, table.sudoku { font-size: 4.5vmin; }
.select-container { font-size: 2vmin; }
</style>
</head>

<body>

<div id="container">

</div>

<script type="text/babel">
var destination = document.querySelector("#container");

function sample(text, n) {
    let bucket = [...Array(text.length)].map((k, i) => i)
    
    function rand() {
       var idx = Math.floor(Math.random() * bucket.length);
       return bucket.splice(idx, 1)[0];
    }
    return [...Array(n)].map(() => text[rand()]);
}

const difficulties = ["easy", "medium", "hard"];

function sudoku_board(diff="easy") {
    return ["3.5..1..2",
            "9...34.5.",
            "..189..67",
            "5...2..34",
            ".4..67.2.",
            "...1..5..",
            "...2.89..",
            ".67....4.",
            ".284.531."];
}

class Sudoku extends React.Component {
    constructor(props) {
        super(props);
        this.state = {kanji: [], board: [], grade: "", diff: "easy"}
        this.generate = this.generate.bind(this);
        this.render_row = this.render_row.bind(this);
        this.render_cell = this.render_cell.bind(this);
        this.grade_button = this.grade_button.bind(this);
        this.diff_button = this.diff_button.bind(this);
    }

    componentDidMount() { this.generate(Object.keys(kanji)[0], "easy"); }
    componentWillUnmount() { this.setState({kanji: [], board: []}) }

    generate(grade, diff) {
        // real logic goes here
        console.log("generate", grade)
        let k = sample(kanji[grade], 9);
        this.setState({kanji: k, board: sudoku_board(), grade: grade, diff: diff})
    }

    render_cell(c, i) {
        return <td key={i}>{this.state.kanji[c - 1]}</td>
    }

    render_row(r, i) {
        return <tr key={i}>{r.split("").map(this.render_cell)}</tr>
    }

    grade_button(name) {
        let cb = (ev) => { ev.preventDefault(); this.generate(name, this.state.diff); };
        return <div className={"select-button" + (this.state.grade == name?" selected":"")} onClick={cb} key={name}>{name}</div>;
    }

    diff_button(name) {
        let cb = (ev) => { ev.preventDefault(); this.generate(this.state.grade, name); };
        return <div className={"select-button" + (this.state.diff == name?" selected":"")} onClick={cb} key={name}>{name}</div>;
    }

    render() {
        return (
            <div className="sudoku">
            <div className="noprint">
                <div className="select-container">
                    <div className="select-title">Kanji grade:</div>{Object.keys(kanji).map(this.grade_button)}
                </div>
                <div className="select-container">
                    <div className="select-title">Sudoku difficulty:</div>{difficulties.map(this.diff_button)}
                </div>
            </div>
            <div>
            <div className="kcont">{this.state.kanji.map((k) => <span className="sudoku wide" key={k}>{k}</span>)}</div>
            </div>
            <div className="tabcontainer">
            <table className="sudoku"><tbody>
                {this.state.board.map(this.render_row)}
            </tbody></table>
            </div>
            <pre className="debug">{"# period state\n" + JSON.stringify(this.state, null, "\t")}</pre>
            </div>
        );
    }
}

var sudoku = new Sudoku();

ReactDOM.render(
    <Sudoku />,
    destination
);
</script>
</body>

</html>
